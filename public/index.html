<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="description"
      content="Personal Budget app to manage expenses, track results, and stay on budget. Free and simple to use."
    />
    <meta
      name="keywords"
      content="budget, personal finance, money management, expense tracker"
    />
    <meta name="author" content="Vatsal Upadhyay" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Personal Budget - Manage Your Expenses</title>
    <link rel="stylesheet" href="reset.css" />
    <link rel="stylesheet" href="main.css" />
  </head>
  <body>
    <header>
      <nav class="menu" aria-label="Main Navigation">
        <ul>
          <li><a href="/">Homepage</a></li>
          <li><a href="/about.html">About</a></li>
          <li><a href="/login.html">Login</a></li>
          <li><a href="https://google.com">Google</a></li>
        </ul>
      </nav>
    </header>

    <main id="main-content">
      <section class="hero">
        <h1>Personal Budget</h1>
        <h2>A personal-budget management app</h2>
      </section>

      <section class="page-area">
        <article class="text-box">
          <h2>Stay on track</h2>
          <p>
            Do you know where you are spending your money? If you really stop to
            track it down, you would get surprised! Proper budget management
            depends on real data... and this app will help you with that!
          </p>
        </article>

        <article class="text-box">
          <h2>Alerts</h2>
          <p>
            What if your clothing budget ended? You will get an alert. The goal
            is to never go over the budget.
          </p>
        </article>

        <article class="text-box">
          <h2>Results</h2>
          <p>
            People who stick to a financial plan, budgeting every expense, get
            out of debt faster! Also, they live happier lives... since they
            expend without guilt or fear... because they know it is all good and
            accounted for.
          </p>
        </article>

        <article class="text-box">
          <h2>Free</h2>
          <!-- ChartJS chart -->
          <canvas
            id="myChart"
            width="300"
            height="300"
            aria-label="Budget Pie Chart"
            role="img"
          ></canvas>
        </article>

        <article class="text-box">
          <h2>D3JS Chart</h2>
          <!-- D3JS chart -->
          <div id="d3-chart"></div>
        </article>
      </section>
    </main>

    <footer class="bottom">
      <div class="center">
        <p aria-label="All rights reserved message">
          All rights reserved &copy; Fabio Nolasco
        </p>
      </div>
    </footer>

    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Libraries -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.11.0/axios.min.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <!-- Scripts -->
    <script>
      // ChartJS
      var dataSource = {
        labels: [],
        datasets: [
          {
            data: [],
            backgroundColor: [
              "#ffcd56",
              "#ff6384",
              "#36a2eb",
              "#fd6b19",
              "#4bc0c0",
              "#9966ff",
              "#c9cbcf"
            ]
          }
        ]
      };

      function createChart() {
        const ctx = document.getElementById("myChart").getContext("2d");
        new Chart(ctx, {
          type: "pie",
          data: dataSource
        });
      }

      function getBudget() {
        axios.get("/budget").then(function (res) {
          for (var i = 0; i < res.data.myBudget.length; i++) {
            dataSource.datasets[0].data[i] = res.data.myBudget[i].budget;
            dataSource.labels[i] = res.data.myBudget[i].title;
          }
          createChart();
        });
      }

      getBudget();

      // D3JS
      d3.json("/budget").then(function (data) {
        const width = 500;
        const height = 300;

        const svg = d3
          .select("#d3-chart")
          .append("svg")
          .attr("width", width)
          .attr("height", height);

        const x = d3
          .scaleBand()
          .domain(data.myBudget.map((d) => d.title))
          .range([0, width])
          .padding(0.1);

        const y = d3
          .scaleLinear()
          .domain([0, d3.max(data.myBudget, (d) => d.budget)])
          .nice()
          .range([height, 0]);

        svg
          .selectAll("rect")
          .data(data.myBudget)
          .enter()
          .append("rect")
          .attr("x", (d) => x(d.title))
          .attr("y", (d) => y(d.budget))
          .attr("width", x.bandwidth())
          .attr("height", (d) => height - y(d.budget))
          .attr("fill", "steelblue");

        // Add axes
        svg
          .append("g")
          .attr("transform", `translate(0,${height})`)
          .call(d3.axisBottom(x));

        svg.append("g").call(d3.axisLeft(y));
      });
    </script>
  </body>
</html>
